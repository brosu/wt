# E2E tests for `wt shellenv` command
name: shellenv
description: Test shell environment setup and validation

scenarios:
  - name: shellenv_produces_output
    description: shellenv command produces output
    skip_shellenv: true  # Run raw binary, don't source shellenv
    skip_shells: [powershell, pwsh]  # Shell detection differs on Windows
    steps:
      - run: $WT_BIN shellenv
        expect:
          exit_code: 0
          output_contains: "wt()"

  - name: shellenv_contains_wt_function
    description: shellenv output contains the wt wrapper function
    skip_shellenv: true
    steps:
      - run: $WT_BIN shellenv
        expect:
          output_contains: "navigating"

  - name: shellenv_bash_specific
    description: shellenv contains bash-specific code
    skip_shellenv: true
    skip_shells: [zsh, powershell, pwsh]
    steps:
      - run: $WT_BIN shellenv
        expect:
          output_contains: "BASH_VERSION"

  - name: shellenv_zsh_specific
    description: shellenv contains zsh-specific code
    skip_shellenv: true
    skip_shells: [bash, powershell, pwsh]
    steps:
      - run: $WT_BIN shellenv
        expect:
          output_contains: "ZSH_VERSION"

  - name: shellenv_powershell_specific
    description: shellenv contains PowerShell-specific code
    skip_shellenv: true
    skip_shells: [bash, zsh]
    steps:
      - run: $WT_BIN shellenv
        expect:
          output_contains: "function wt"

  - name: shellenv_uses_portable_sed
    description: shellenv uses portable sed syntax for completion (not gawk)
    skip_shellenv: true
    skip_shells: [powershell, pwsh]
    steps:
      - run: $WT_BIN shellenv
        expect:
          output_contains: "sed -n"
          output_not_contains: "match($0"

  - name: shellenv_completion_sed_works
    description: The sed command for branch extraction works correctly
    skip_shellenv: true
    skip_shells: [powershell, pwsh]
    steps:
      - run: |
          echo '/path/to/main  abc1234 [main]
          /path/to/feature  def5678 [feature-branch]' | tail -n +2 | sed -n 's/.*\[\([^]]*\)\].*/\1/p'
        expect:
          exit_code: 0
          output_contains: "feature-branch"
